# MSA 이벤트 기반 아키텍처

## 개요

이벤트 기반 아키텍처(EDA)는 이벤트의 생성, 감지, 소비, 반응을 통해 마이크로서비스 간 통신을 수행하는 설계 패턴입니다. 느슨한 결합, 확장성, 회복력을 제공하여 현대 분산 시스템에 적합합니다.

## 핵심 개념

### 이벤트
- 시스템 내 중요한 상태 변화나 발생 사건
- 불변성, 타임스탬프, 관련 데이터 포함
- 도메인 이벤트(주문완료, 결제처리) vs 시스템 이벤트(서비스시작, DB연결)

### 구성 요소
- **이벤트 생산자**: 이벤트를 생성하고 발행하는 서비스
- **이벤트 소비자**: 이벤트를 구독하고 처리하는 서비스  
- **이벤트 브로커**: 이벤트 라우팅 및 전달 (Kafka, RabbitMQ, EventBridge)

## 주요 이점

- **느슨한 결합**: 서비스 간 직접 의존성 제거
- **확장성**: 비동기 통신으로 독립적 확장
- **회복력**: 개별 서비스 장애 시에도 시스템 지속 동작
- **실시간 처리**: 즉시 이벤트 반응 및 처리

## 핵심 패턴

### 이벤트 소싱
- 모든 상태 변경을 이벤트로 저장
- 현재 상태는 이벤트 재생으로 복구
- 완전한 감사 추적 제공

### CQRS (명령 쿼리 책임 분리)
- 읽기/쓰기 모델 분리
- 명령 → 이벤트 → 모델 업데이트

### 사가 패턴
- 분산 트랜잭션 관리
- 보상 액션으로 롤백 처리
- 오케스트레이션 vs 코레오그래피

## 기술 스택

### 이벤트 브로커
- Apache Kafka (고처리량 스트리밍)
- RabbitMQ (유연한 라우팅)
- Cloud 서비스 (EventBridge, Pub/Sub)

### 지원 기술
- 스키마 관리: Avro, Schema Registry
- 스트림 처리: Kafka Streams, Flink
- 모니터링: 분산 추적, 상관관계 ID

## 구현 고려사항

### 설계 원칙
- 이벤트를 불변하고 자체 완결적으로 설계
- 멱등성 있는 이벤트 처리
- 적절한 이벤트 명명 규칙

### 운영 고려사항
- 스키마 진화 전략
- 이벤트 순서 및 중복 처리
- 오류 처리 (데드 레터 큐, 재시도)
- 최종적 일관성 관리

## 주요 도전과제

- **최종적 일관성**: 즉시 일관성 대신 최종적 일관성 수용
- **복잡한 디버깅**: 분산 이벤트 플로우 추적 어려움
- **스키마 진화**: 하위 호환성 유지 필요
- **이벤트 순서**: 비즈니스 로직에 따른 순서 보장

## 추가 학습 필요 개념

### 핵심 기술 구현
- [ ] **Apache Kafka 심화**
  - Kafka 클러스터 설정 및 운영
  - 파티셔닝 전략 및 컨슈머 그룹 관리
  - 오프셋 관리 및 재처리 전략
  - Kafka Connect를 통한 데이터 파이프라인 구축

- [ ] **Spring Boot 이벤트 처리**
  - Spring Kafka 설정 및 최적화
  - @KafkaListener 어노테이션 활용
  - KafkaTemplate을 통한 이벤트 발행
  - Spring Cloud Stream 함수형 프로그래밍

- [ ] **스키마 관리 시스템**
  - Confluent Schema Registry 구축
  - Apache Avro 스키마 설계
  - 스키마 진화 전략 (하위/상위 호환성)
  - Protocol Buffers 대안 검토

### 로깅 및 모니터링
- [ ] **구조화된 로깅 시스템**
  - JSON 형태의 통합 로그 포맷 설계
  - MDC를 활용한 상관관계 추적 (traceId, spanId)
  - Logback 설정을 통한 롤링 정책
  - 이벤트 처리 성능 로깅

- [ ] **ELK Stack 기반 로그 집계**
  - Elasticsearch 클러스터 구성
  - Logstash 파이프라인 설계
  - Filebeat를 통한 로그 수집
  - Kibana 대시보드 구성

- [ ] **분산 추적 시스템**
  - Spring Cloud Sleuth + Zipkin 구축
  - OpenTelemetry 도입 검토
  - 마이크로서비스 간 요청 추적
  - 성능 병목 지점 식별

### 아키텍처 패턴 심화
- [ ] **Event Sourcing 실제 구현**
  - EventStore 데이터베이스 설계
  - 이벤트 재생 메커니즘 구현
  - 스냅샷 생성 전략
  - 이벤트 버전 관리

- [ ] **CQRS 패턴 적용**
  - Command/Query 모델 분리
  - 읽기 전용 프로젝션 구성
  - 데이터 동기화 전략
  - 성능 최적화 방안

- [ ] **Saga 패턴 구현**
  - Orchestration vs Choreography 선택
  - 보상 트랜잭션 설계
  - 분산 트랜잭션 상태 관리
  - 실패 시나리오 처리

### 실전 프로젝트 기반 학습
- [ ] **온라인 쇼핑몰 시스템 구현**
  - User, Order, Payment, Inventory 서비스 설계
  - 주문 생성부터 결제 완료까지 이벤트 플로우
  - 재고 예약 및 해제 로직
  - 알림 서비스 통합

- [ ] **대용량 데이터 처리**
  - Kafka Streams를 활용한 실시간 분석
  - 이벤트 기반 ETL 파이프라인
  - 배치와 스트림 처리 하이브리드
  - 데이터 품질 모니터링

### 운영 및 DevOps
- [ ] **컨테이너화 및 오케스트레이션**
  - Docker를 통한 서비스 컨테이너화
  - Kubernetes 환경에서 MSA 배포
  - Helm Chart를 통한 배포 자동화
  - Service Mesh (Istio) 도입

- [ ] **CI/CD 파이프라인**
  - GitLab/GitHub Actions 기반 파이프라인
  - 마이크로서비스별 독립 배포
  - 컨테이너 이미지 빌드/배포 자동화
  - Blue-Green/Canary 배포 전략

- [ ] **성능 최적화 및 부하 테스트**
  - JMeter/Gatling을 통한 성능 테스트
  - Kafka 파티션 튜닝
  - JVM 옵션 최적화
  - 리소스 사용량 모니터링

### 보안 및 거버넌스
- [ ] **이벤트 보안**
  - Kafka SSL/SASL 설정
  - 이벤트 암호화 및 서명
  - 마이크로서비스 간 인증/인가
  - API Gateway를 통한 접근 제어

- [ ] **데이터 거버넌스**
  - GDPR 준수를 위한 개인정보 처리
  - 이벤트 데이터 보관 정책
  - 감사 로그 관리
  - 데이터 품질 관리